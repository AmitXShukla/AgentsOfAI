{"kind":"Article","sha256":"6bfc0ab8c2f0a5feb9489f37ace75a271df57649abf9528103088200f3410eb3","slug":"broadcast","location":"/content/broadcast.md","dependencies":[],"frontmatter":{"title":"Broadcasting","content_includes_title":false,"github":"https://github.com/AmitXShukla/AgentsOfAI","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/AmitXShukla/AgentsOfAI/blob/main/content/broadcast.md","exports":[{"format":"md","filename":"broadcast.md","url":"/build/broadcast-3c9bf54a3cf345d374e6b065ab82a00c.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Broadcast","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cJiqsaEsWd"}],"identifier":"broadcast","label":"Broadcast","html_id":"broadcast","implicit":true,"key":"V1U5AAsA9p"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Broadcast is effectively the publish/subscribe model with topic and subscription. Read Topic and Subscription to learn the core concepts.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TTBErA6DR3"}],"key":"Nzb3S98fTd"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The key difference between direct messaging and broadcast is that broadcast cannot be used for request/response scenarios. When an agent publishes a message it is one way only, it cannot receive a response from any other agent, even if a receiving agent’s handler returns a value.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jzARC7HBAF"}],"key":"yAnJcrfhdL"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Ozwt3F2E2i"}],"key":"Q4APgFqAxP"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"If a response is given to a published message, it will be thrown away.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"eByD4d9j5q"}],"key":"hVe6ey6POP"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Note","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"IlFztFXYs1"}],"key":"V9ZNcWUCK6"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"If an agent publishes a message type for which it is subscribed it will not receive the message it published. This is to prevent infinite loops.\nSubscribe and Publish to Topics","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"WWKlM5fooL"}],"key":"Pdmvn8eUkz"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Type-based subscription maps messages published to topics of a given topic type to agents of a given agent type. To make an agent that subclasses RoutedAgent subscribe to a topic of a given topic type, you can use the type_subscription() class decorator.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"NwUEjyVau9"}],"key":"Fo43CfVPdN"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"The following example shows a ReceiverAgent class that subscribes to topics of “default” topic type using the type_subscription() decorator. and prints the received messages.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Rr2hAoxeQr"}],"key":"CgMEljUn07"},{"type":"code","lang":"python","value":"from autogen_core import RoutedAgent, message_handler, type_subscription\n\n\n@type_subscription(topic_type=\"default\")\nclass ReceivingAgent(RoutedAgent):\n    @message_handler\n    async def on_my_message(self, message: Message, ctx: MessageContext) -> None:\n        print(f\"Received a message: {message.content}\")","position":{"start":{"line":22,"column":1},"end":{"line":31,"column":1}},"key":"nBCeZkdxNE"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"To publish a message from an agent’s handler, use the publish_message() method and specify a TopicId. This call must still be awaited to allow the runtime to schedule delivery of the message to all subscribers, but it will always return None. If an agent raises an exception while handling a published message, this will be logged but will not be propagated back to the publishing agent.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"MFzv0hnV3b"}],"key":"cc8ztWQjal"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"The following example shows a BroadcastingAgent that publishes a message to a topic upon receiving a message.","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"s7GR3xpE5I"}],"key":"hVpSjN9tLj"},{"type":"code","lang":"python","value":"from autogen_core import TopicId\n\n\nclass BroadcastingAgent(RoutedAgent):\n    @message_handler\n    async def on_my_message(self, message: Message, ctx: MessageContext) -> None:\n        await self.publish_message(\n            Message(\"Publishing a message from broadcasting agent!\"),\n            topic_id=TopicId(type=\"default\", source=self.id.key),\n        )","position":{"start":{"line":37,"column":1},"end":{"line":48,"column":1}},"key":"aSNcSinUu5"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"BroadcastingAgent publishes message to a topic with type “default” and source assigned to the agent instance’s agent key.","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"Uy6d7sTfms"}],"key":"Ym1wphtsDA"},{"type":"paragraph","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Subscriptions are registered with the agent runtime, either as part of agent type’s registration or through a separate API method. Here is how we register TypeSubscription for the receiving agent with the type_subscription() decorator, and for the broadcasting agent without the decorator.","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"NxsWAjgJQe"}],"key":"Ov56jx4eTm"},{"type":"code","lang":"python","value":"from autogen_core import TypeSubscription\n\nruntime = SingleThreadedAgentRuntime()\n\n# Option 1: with type_subscription decorator\n# The type_subscription class decorator automatically adds a TypeSubscription to\n# the runtime when the agent is registered.\nawait ReceivingAgent.register(runtime, \"receiving_agent\", lambda: ReceivingAgent(\"Receiving Agent\"))\n\n# Option 2: with TypeSubscription\nawait BroadcastingAgent.register(runtime, \"broadcasting_agent\", lambda: BroadcastingAgent(\"Broadcasting Agent\"))\nawait runtime.add_subscription(TypeSubscription(topic_type=\"default\", agent_type=\"broadcasting_agent\"))\n\n# Start the runtime and publish a message.\nruntime.start()\nawait runtime.publish_message(\n    Message(\"Hello, World! From the runtime!\"), topic_id=TopicId(type=\"default\", source=\"default\")\n)\nawait runtime.stop_when_idle()","position":{"start":{"line":54,"column":1},"end":{"line":74,"column":1}},"key":"pxumsb7x3B"},{"type":"admonition","kind":"seealso","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"result","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"lRQATEAfBi"}],"key":"HlxVeBuDnN"},{"type":"paragraph","position":{"start":{"line":77,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"Received a message: Hello, World! From the runtime!\nReceived a message: Publishing a message from broadcasting agent!","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"XNIOZtTOaL"}],"key":"cYGxMoevlO"}],"key":"d1AXzitVt1"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"As shown in the above example, you can also publish directly to a topic through the runtime’s publish_message() method without the need to create an agent instance.","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"f1yvMf6Aln"}],"key":"iv8Y9hnHGc"},{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"From the output, you can see two messages were received by the receiving agent: one was published through the runtime, and the other was published by the broadcasting agent.\nDefault Topic and Subscriptions","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"r9bkznc9Mt"}],"key":"PfUd9mETgh"},{"type":"paragraph","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"In the above example, we used TopicId and TypeSubscription to specify the topic and subscriptions respectively. This is the appropriate way for many scenarios. However, when there is a single scope of publishing, that is, all agents publish and subscribe to all broadcasted messages, we can use the convenience classes DefaultTopicId and default_subscription() to simplify our code.","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"FADgirG7sJ"}],"key":"kXvfhCJ4bv"},{"type":"paragraph","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"DefaultTopicId is for creating a topic that uses “default” as the default value for the topic type and the publishing agent’s key as the default value for the topic source. default_subscription() is for creating a type subscription that subscribes to the default topic. We can simplify BroadcastingAgent by using DefaultTopicId and default_subscription().","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"Sl8zrJDYsr"}],"key":"hfkVdNdN4A"},{"type":"code","lang":"python","value":"from autogen_core import DefaultTopicId, default_subscription\n\n\n@default_subscription\nclass BroadcastingAgentDefaultTopic(RoutedAgent):\n    @message_handler\n    async def on_my_message(self, message: Message, ctx: MessageContext) -> None:\n        # Publish a message to all agents in the same namespace.\n        await self.publish_message(\n            Message(\"Publishing a message from broadcasting agent!\"),\n            topic_id=DefaultTopicId(),\n        )","position":{"start":{"line":90,"column":1},"end":{"line":103,"column":1}},"key":"N70BGwZVAq"},{"type":"paragraph","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"When the runtime calls register() to register the agent type, it creates a TypeSubscription whose topic type uses “default” as the default value and agent type uses the same agent type that is being registered in the same context.","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"fToqY8IvH3"}],"key":"PEqsq7nqR5"},{"type":"code","lang":"python","value":"runtime = SingleThreadedAgentRuntime()\nawait BroadcastingAgentDefaultTopic.register(\n    runtime, \"broadcasting_agent\", lambda: BroadcastingAgentDefaultTopic(\"Broadcasting Agent\")\n)\nawait ReceivingAgent.register(runtime, \"receiving_agent\", lambda: ReceivingAgent(\"Receiving Agent\"))\nruntime.start()\nawait runtime.publish_message(Message(\"Hello, World! From the runtime!\"), topic_id=DefaultTopicId())\nawait runtime.stop_when_idle()","position":{"start":{"line":107,"column":1},"end":{"line":116,"column":1}},"key":"uMIRFt2MjR"},{"type":"admonition","kind":"seealso","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"result","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"eg5YrdnI2T"}],"key":"s716ogT38K"},{"type":"paragraph","position":{"start":{"line":119,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"Received a message: Hello, World! From the runtime!\nReceived a message: Publishing a message from broadcasting agent!","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"PGbtHQOQk7"}],"key":"Kyk6W2mblW"}],"key":"AVO6d9Ihjz"}],"key":"PIn5Z3Y7F4"}],"key":"Hnzc1qcqSq"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Direct Messages","url":"/messaging","group":"AutoGen Core"},"next":{"title":"why AgentChat","url":"/agentchat","group":"Agent Chat"}}},"domain":"http://localhost:3001"}